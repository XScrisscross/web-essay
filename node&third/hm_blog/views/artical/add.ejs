<%- include('../layout/header.ejs') %>

<link rel="stylesheet" href="/mditor/dist/css/mditor.min.css">
<script src="/mditor/dist/js/mditor.min.js"></script>

<div class="container">
  <h1>发表文章页</h1>
  <hr>
  <form id="form">
    <!-- 在进入文章添加页面的一瞬间，就立即把 文章的 作者Id，保存到 一个隐藏域中，防止 session 失效的问题 -->
    <div><%=id%></div>
    <input type="hidden" name="authorId" value="<%=id%>">
    <div class="form-group">
      <label>文章标题：</label>
      <input type="text" name="title" class="form-control" required>
    </div>

    <div class="form-group">
      <label>文章内容：</label>
      <textarea name="content" class="form-control" id="editor"></textarea>
    </div>

    <div class="form-group">
      <input type="submit" value="发表文章" class="btn btn-primary" id="btns">
    </div>
  </form>
</div>

<script>
  $(function () {
    // 初始化编辑器
    var mditor = Mditor.fromTextarea(document.getElementById('editor'));

    $('#btns').on('click', function (e) {

      e.preventDefault()
      console.log(11111);
      $.ajax({
        url: '/artical/padd',
        data: $('#form').serialize(),
        type: 'POST',
        dataType: 'json',
        success: function (result) {
          if (result.status == 200) {
            console.log("ok");
            location.href = '/article/info/' + result.insertId
          } else {
            alert("文章发表失败");
          }
        }
      })
    })
  })
</script>

<%- include('../layout/footer.ejs') %>