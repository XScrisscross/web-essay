<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
    </style>
    <script src="jquery.min.js"></script>
</head>

<body>
    <section id="map"></section>
    <script>
        // v2.0 jquery
        // 蛇渲染
        // function snakeBehavior($map) {
        //     this.$map = $map;
        //     this.init();
        //     this.bind();
        // }

        // snakeBehavior.prototype.init = function () {
        //     alert("333");
        // };

        // snakeBehavior.prototype.bind = function () {
        //     alert("444");
        // };

        // SnakeBehavior = (function () {
        //     return {
        //         lanuch: function ($item) {
        //             $item.each(function (index, node) {
        //                 new snakeBehavior($(node));
        //             });
        //         }
        //     };
        // })();

        // 点渲染
        // function dotRender($item) {
        //     this.$map = $item;
        //     return this.init();
        // }

        // dotRender.prototype.init = function () {
        //     // console.log(this.$map.children().length);
        //     if (this.$map.children().length === 0) {
        //         this.$dot = this.$map.append("<div></div>").find("div").css({
        //             position: "absolute",
        //             width: 20,
        //             height: 20,
        //             backgroundColor: "green"
        //         });
        //     }
        //     this.$dot.css({
        //         top: Math.floor(Math.random() * (this.$map.width() - this.$dot.width()) / this.$dot.width()) * this.$dot.width(),
        //         left: Math.floor(Math.random() * (this.$map.height() - this.$dot.height()) / this.$dot.height()) * this.$dot.height()
        //     });

        //     return this.$dot;
        // };

        // DotRender = (function () {
        //     return {
        //         lanuch: function ($item) {
        //             return new dotRender($item);
        //         }
        //     }
        // })();

        // 图渲染
        // function mapRender($item) {
        //     this.$item = $item;
        //     return this.init();
        // }

        // mapRender.prototype.init = function () {
        //     this.$map = this.$item.append("<div></div>").find("div").css({
        //         position: "relative",
        //         margin: "0 auto",
        //         width: 800,
        //         height: 600,
        //         backgroundColor: "#ccc"
        //     });
        //     return this.$map;
        // };

        // MapRender = (function () {
        //     return {
        //         lanuch: function ($item) {
        //             return new mapRender($item);
        //         }
        //     }
        // })();

        // let $map = MapRender.lanuch($("section"));
        // let $dot = DotRender.lanuch($map);
        // console.log($dot);



        // v1.0 js版
        // 点
        function Dot() {
            this.width = 20;
            this.height = 20;
            this.bgColor = "green";
            this.position = "absolute";
            this.offsetx = 0;
            this.offsety = 0;
            this.div = null;
        }

        // 蛇
        function Snake() {
            this.width = 20;
            this.height = 20;
            this.position = "absolute";
            this.direction = "right";
            this.body = [
                { x: 4, y: 2, bgColor: "red", isCreate: null },
                { x: 3, y: 2, bgColor: "blue", isCreate: null },
                { x: 2, y: 2, bgColor: "blue", isCreate: null }
            ];
        }

        Snake.prototype.render = function (oMap) {
            this.body.forEach((item, index) => {
                if (item.isCreate == null) {
                    item.isCreate = document.createElement("div");
                }

                item.isCreate.style.width = this.width + "px";
                item.isCreate.style.height = this.height + "px";
                item.isCreate.style.position = this.position;
                item.isCreate.style.left = item.x * this.width + "px";
                item.isCreate.style.top = item.y * this.height + "px";
                item.isCreate.style.backgroundColor = item.bgColor;
                oMap.appendChild(item.isCreate);
            });
        };

        Snake.prototype.move = function () {
            // 蛇身
            for (let i = this.body.length - 1; i > 0; i--) {
                // console.log(this.body[i]);
                this.body[i].x = this.body[i - 1].x;
                this.body[i].y = this.body[i - 1].y;
            }

            // 蛇头
            switch (this.direction) {
                case "right":
                    this.body[0].x = this.body[0].x + 1;
                    break;
                case "left":
                    this.body[0].x = this.body[0].x - 1;
                    break;
                case "top":
                    this.body[0].y = this.body[0].y - 1;
                    break;
                case "bottom":
                    this.body[0].y = this.body[0].y + 1;
                    break;
            }

        }
        // 渲染位置
        Dot.prototype.render = function (oMap) {
            // 设置属性
            if (this.div == null) {
                this.div = document.createElement("div");
            }
            this.div.style.width = this.width + "px";
            this.div.style.height = this.height + "px";
            this.div.style.backgroundColor = this.bgColor;
            this.div.style.position = this.position;

            this.offsetx = Math.floor(Math.random() * (oMap.offsetWidth - this.width) / this.width);
            this.offsety = Math.floor(Math.random() * (oMap.offsetHeight - this.height) / this.height);

            this.div.style.left = this.offsetx * this.width + "px";
            this.div.style.top = this.offsety * this.height + "px";
            oMap.appendChild(this.div);
        };

        let map = document.querySelector("#map");
        let dot = new Dot();
        let sanke = new Snake();
        let count = 500;
        dot.render(map);
        sanke.render(map);

        let change = function (count) {
            sanke.move();

            if (sanke.body[0].x < 0 || sanke.body[0].y < 0 || sanke.body[0].y == map.offsetHeight / sanke.height || sanke.body[0].x == map.offsetWidth / sanke.width) {
                clearInterval(timer);
                return;
            }

            if (sanke.body[0].x == dot.offsetx && sanke.body[0].y == dot.offsety) {
                count = count / 2;
                setInterval(change(count), count);
                let x = sanke.body[sanke.body.length - 1].x;
                let y = sanke.body[sanke.body.length - 1].y;
                console.log(x, y);
                sanke.body.push(
                    { x: x, y: y, bgColor: "blue", isCreate: null }
                );
                dot.render(map);
            }

            for (let index = 1; index < sanke.body.length; index++) {
                if (sanke.body[index].x == sanke.body[0].x && sanke.body[index].y == sanke.body[0].y) {
                    clearInterval(timer);
                    return;
                }
            }

            sanke.render(map);
        }

        let timer = setInterval(change, count);

        //键盘控制
        document.onkeydown = function (e) {
            var e = window.event || event;
            switch (e.keyCode) {
                case 37:
                    if (sanke.direction == "right") return;
                    sanke.direction = "left";
                    break;
                case 38:
                    if (sanke.direction == "bottom") return;
                    sanke.direction = "top";
                    break;
                case 39:
                    if (sanke.direction == "left") return;
                    sanke.direction = "right";
                    break;
                case 40:
                    if (sanke.direction == "top") return;
                    sanke.direction = "bottom";
                    break;
            }
        }

        function auto(dot, snake, map) {
            console.log(snake.body[0].x);
            console.log(snake.body[0].y);
            if (snake.body[0].x == 40) {

            }
        };
        auto(dot, sanke, map);

    </script>
</body>

</html>