<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" type="text/css" href="css/index.css">
</head>

<body>
	<div id="app">
		<div class="grid">
			<div>
				<h1>图书管理</h1>
				<div class="book">
					<div>
						<label for="id">
							编号：
						</label>
						<input type="text" id="id" disabled>
						<label for="name">
							名称：
						</label>
						<input type="text" id="name">
						<button>提交</button>
					</div>
				</div>
			</div>
			<div class="total">
				<span>图书总数：</span>
				<span></span>
			</div>
			<table>
				<thead>
					<tr>
						<th>编号</th>
						<th>名称</th>
						<th>时间</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
					<tr :key="item.id" v-for="item in books">
						<td>{{item.id}}</td>
						<td>{{item.name}}</td>
						<td>{{item.date | format('MMMM Do YYYY, h:mm:ss a')}}</td>
						<td>
							<a href="">修改</a>
							<span>|</span>
							<a href="" @click.prevent="delBook(item.id)">删除</a>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<script src="js/vue.js"></script>
	<script src="js/axios.js"></script>
	<script src="http://momentjs.cn/downloads/moment.js"></script>

	<script type="text/javascript">
		// 一定要先配置好初始化操作
		// vue 配置
		Vue.filter("format", function (date, fmStr) {
			return moment(date).format(fmStr)
		})

		// axios 初始化
		axios.defaults.baseURL = 'http://localhost:3000/';

		axios.interceptors.response.use(function (ret) {
			return ret.data
		}, function (err) {
			console.log(err);
		})

		let vm = new Vue({
			el: "#app",
			data: {
				books: []
			},
			methods: {
				async queryData() {
					this.books = await axios.get("books")
				},

				async delBook(id) {
					var ret = await axios.delete("books/" + id)

					console.log(ret.status);


					// if (status !== 200) {t
					// 	console.log("删除失败");
					// 	return
					// }

					// this.queryData();
					// console.log("删除成功");
				}
			},

			created() {
				this.queryData()
			}
		});
	</script>
</body>

</html>