<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="./layui/css/layui.css" media="all">
  <script src="./layui/layui.js"></script>
  <style>
    /******BASE STYLE******/
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Microsoft YaHei';
    }

    img {
      border: 0;
      vertical-align: middle;
    }

    button {
      border: none;
      outline: none;
    }

    input,
    select {
      outline: none;
    }

    ul,
    ol,
    li {
      list-style: none;
    }

    /******COMMON STYLE*******/
    table,
    tr,
    th,
    td {
      padding: 0;
      font-size: 14px;
    }

    tr th {
      background-color: #eaeef1;
      color: #333333;
    }

    tr td {
      background-color: #ffffff;
      color: #333333;
    }

    tr th div {
      font-weight: 700;
    }

    .layui-table,
    .layui-table-view {
      margin: 0;
    }

    .layui-table-view .layui-table td,
    .layui-table-view .layui-table th {
      padding: 0;
      border-top: none;
      border-left: none;
    }

    .layui-table td,
    .layui-table th,
    .layui-table-col-set,
    .layui-table-fixed-r,
    .layui-table-grid-down,
    .layui-table-header,
    .layui-table-page,
    .layui-table-tips-main,
    .layui-table-tool,
    .layui-table-total,
    .layui-table-view,
    .layui-table[lay-skin='line'],
    .layui-table[lay-skin='row'] {
      border-style: solid;
      border-color: #cdd3d7;
    }

    .layui-table-cell {
      height: 40px;
      line-height: 40px;
      padding: 0 4px;
    }

    th .layui-table-cell {
      padding: 0 8px;
    }

    /* .layui-table-body tr:hover td div {
  background-color: #eaeef1;
} */

    .layui-laypage-default {
      height: 40px;
      float: right;
    }

    .layui-table-page {
      background-color: #eaeef1;
    }

    .two .layui-table-view {
      padding: 10px;
    }

    .layui-table-box td,
    .layui-table-header th {
      height: 30px;
    }

    .layui-table-page {
      height: 40px;
      border-width: 0;
      border-bottom: 1px solid #cdd3d7;
    }

    .layui-table-page .layui-laypage button {
      height: 25px;
      width: 50px;
      padding: 0;
      line-height: 25px;
    }

    .layui-table-page .layui-laypage input {
      height: 25px;
      width: 50px;
      padding: 0;
      line-height: 25px;
    }

    .layui-laypage-limits select {
      width: 80px;
      height: 18px;
    }

    .layui-table-tips-c:before {
      position: relative;
      right: 1px;
      top: -3px;
    }

    /******GENERAL STYLE******/
    .fl {
      float: left;
    }

    .fr {
      float: right;
    }

    .clearfix::after {
      content: '';
      display: block;
      clear: both;
    }

    .text-overflow {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .text-wrap {
      height: auto;
      overflow: visible;
      text-overflow: inherit;
      white-space: normal;
      text-align: center;
    }

    /******SIZE STYLE******/
    .m5 {
      margin: 5px;
    }

    .m10 {
      margin: 10px;
    }

    .m20 {
      margin: 20px;
    }

    .mt5 {
      margin-top: 5px;
    }

    .mt10 {
      margin-top: 10px;
    }

    .mt20 {
      margin-top: 20px;
    }

    .mt30 {
      margin-top: 30px;
    }

    .mt50 {
      margin-top: 50px;
    }

    .mt100 {
      margin-top: 100px;
    }

    .mb5 {
      margin-bottom: 5px;
    }

    .mb10 {
      margin-bottom: 10px;
    }

    .mb20 {
      margin-bottom: 20px;
    }

    .mb30 {
      margin-bottom: 30px;
    }

    .mb50 {
      margin-bottom: 50px;
    }

    .mb100 {
      margin-bottom: 100px;
    }

    .ml5 {
      margin-left: 5px;
    }

    .ml10 {
      margin-left: 10px;
    }

    .ml20 {
      margin-left: 20px;
    }

    .ml30 {
      margin-left: 30px;
    }

    .ml50 {
      margin-left: 50px;
    }

    .ml100 {
      margin-left: 100px;
    }

    .mr5 {
      margin-right: 5px;
    }

    .mr10 {
      margin-right: 10px;
    }

    .mr20 {
      margin-right: 20px;
    }

    .mr30 {
      margin-right: 30px;
    }

    .mr50 {
      margin-right: 50px;
    }

    .mr100 {
      margin-right: 100px;
    }

    .p5 {
      padding: 5px;
    }

    .p10 {
      padding: 10px;
    }

    .p20 {
      padding: 20px;
    }

    .pt5 {
      padding-top: 5px;
    }

    .pt10 {
      padding-top: 10px;
    }

    .pt20 {
      padding-top: 20px;
    }

    .pt30 {
      padding-top: 30px;
    }

    .pt50 {
      padding-top: 50px;
    }

    .pt100 {
      padding-top: 100px;
    }

    .pb5 {
      padding-bottom: 5px;
    }

    .pb10 {
      padding-bottom: 10px;
    }

    .pb20 {
      padding-bottom: 20px;
    }

    .pb30 {
      padding-bottom: 30px;
    }

    .pb50 {
      padding-bottom: 50px;
    }

    .pb100 {
      padding-bottom: 100px;
    }

    .pl5 {
      padding-left: 5px;
    }

    .pl10 {
      padding-left: 10px;
    }

    .pl20 {
      padding-left: 20px;
    }

    .pl30 {
      padding-left: 30px;
    }

    .pl50 {
      padding-left: 50px;
    }

    .pl100 {
      padding-left: 100px;
    }

    .pr5 {
      padding-right: 5px;
    }

    .pr10 {
      padding-right: 10px;
    }

    .pr20 {
      padding-right: 20px;
    }

    .pr30 {
      padding-right: 30px;
    }

    .pr50 {
      padding-right: 50px;
    }

    .pr100 {
      padding-right: 100px;
    }
  </style>
</head>

<body style="padding: 10px;">
  <table class="layui-hide" id="demo" lay-filter="test"></table>

  <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    </script>

  <script type="text/html" id="barDemo1">
        <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    </script>

  <script>
    layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider'], function () {
      var table = layui.table
      table.render({
        elem: '#demo',
        height: 670,
        data: [
          {
            'usermane': "12",
            'experience': "12",
            'sex': "12",
            'score': "12",
            'city': "12",
            'right': "12"
          },
          {
            'usermane': "12",
            'experience': "12",
            'sex': "12",
            'score': "12",
            'city': "12",
            'right': "12"
          },
          {
            'usermane': "12",
            'experience': "12",
            'sex': "12",
            'score': "12",
            'city': "12",
            'right': "12"
          },
          {
            'usermane': "12",
            'experience': "12",
            'sex': "12",
            'score': "12",
            'city': "12",
            'right': "12"
          },
        ],
        title: '用户表',
        page: true,
        cols: [[ //表头
          {
            field: 'username',
            title: '用户名',
            minWidth: 100,
            event: 'collapse',
            templet: function (data) {
              return '<div style="position: relative;\n' + '    padding: 0 10px 0 20px;">' + data.usermane + '<i style="left: 0px;" lay-tips="展开" class="layui-icon layui-colla-icon layui-icon-right"></i></div>'
            }
          },
          {
            field: 'experience',
            title: '积分',
            width: 90,
            sort: true
          },
          {
            field: 'sex',
            title: '性别',
            width: 80,
            sort: true
          },
          {
            field: 'score',
            title: '评分',
            width: 80,
            sort: true
          },
          {
            field: 'city',
            title: '城市',
            width: 150
          },
          {
            fixed: 'right',
            width: 80,
            align: 'center',
            toolbar: '#barDemo'
          }]]
      });

      table.on('tool(test)', function (obj) {
        var data = obj.data;
        if (obj.event === 'collapse') {
          var trObj = layui.$(this).parent('tr'); //当前行
          var accordion = false //开启手风琴，那么在进行折叠操作时，始终只会展现当前展开的表格。
          var content = '<table></table>' //内容
          //表格行折叠方法
          collapseTable({
            elem: trObj,
            accordion: accordion,
            content: content,
            success: function (trObjChildren, index) { //成功回调函数
              //trObjChildren 展开tr层DOM
              //index 当前层索引
              trObjChildren.find('table').attr("id", index);
              table.render({
                elem: "#" + index,
                data: [
                  {
                    'usermane': "12",
                    'experience': "12",
                    'sex': "12",
                    'score': "12",
                    'city': "12",
                    'right': "12"
                  },
                  {
                    'usermane': "12",
                    'experience': "12",
                    'sex': "12",
                    'score': "12",
                    'city': "12",
                    'right': "12"
                  },
                  {
                    'usermane': "12",
                    'experience': "12",
                    'sex': "12",
                    'score': "12",
                    'city': "12",
                    'right': "12"
                  },
                  {
                    'usermane': "12",
                    'experience': "12",
                    'sex': "12",
                    'score': "12",
                    'city': "12",
                    'right': "12"
                  },
                ],
                limit: 3,
                cellMinWidth: 80,
                cols: [[
                  {
                    field: 'id',
                    width: 80,
                    title: 'ID',
                    sort: true
                  },
                  {
                    field: 'username',
                    title: '用户名'
                  },
                  {
                    field: 'sex',
                    title: '性别',
                    sort: true
                  },
                ]]
              });
            }
          });
        }
      });

      function collapseTable(options) {
        var trObj = options.elem;
        if (!trObj) return;
        var accordion = options.accordion,
          success = options.success,
          content = options.content || '';
        var tableView = trObj.parents('.layui-table-view'); //当前表格视图
        var id = tableView.attr('lay-id'); //当前表格标识
        var index = trObj.data('index'); //当前行索引
        var leftTr = tableView.find('.layui-table-fixed.layui-table-fixed-l tr[data-index="' + index + '"]'); //左侧当前固定行
        var rightTr = tableView.find('.layui-table-fixed.layui-table-fixed-r tr[data-index="' + index + '"]'); //右侧当前固定行
        var colspan = trObj.find('td').length; //获取合并长度
        var trObjChildren = trObj.next(); //展开行Dom
        var indexChildren = id + '-' + index + '-children'; //展开行索引
        var leftTrChildren = tableView.find('.layui-table-fixed.layui-table-fixed-l tr[data-index="' + indexChildren + '"]'); //左侧展开固定行
        var rightTrChildren = tableView.find('.layui-table-fixed.layui-table-fixed-r tr[data-index="' + indexChildren + '"]'); //右侧展开固定行
        var lw = leftTr.width(); //左宽
        var rw = rightTr.width(); //右宽
        if (trObjChildren.data('index') != indexChildren) {//不存在就创建展开行
          var tr = '<tr data-index="' + indexChildren + '"><td colspan="' + colspan + '"><div style="height: auto;padding-left:' + lw + 'px;padding-right:' + rw + 'px" class="layui-table-cell">' + content + '</div></td></tr>'; //装载HTML元素
          trObjChildren = trObj.after(tr).next().hide(); //隐藏展开行
          var fixTr = '<tr data-index="' + indexChildren + '"></tr>';//固定行
          leftTrChildren = leftTr.after(fixTr).next().hide(); //左固定
          rightTrChildren = rightTr.after(fixTr).next().hide(); //右固定
        }
        trObj.find('td[lay-event="collapse"] i.layui-colla-icon').toggleClass("layui-icon-right layui-icon-down"); //展开|折叠箭头图标
        trObjChildren.toggle();//显示|隐藏展开行
        if (accordion) { //开启手风琴折叠和折叠箭头
          trObj.siblings().find('td[lay-event="collapse"] i.layui-colla-icon').removeClass("layui-icon-down").addClass("layui-icon-right");
          trObjChildren.siblings('[data-index$="-children"]').hide(); //展开
          rightTrChildren.siblings('[data-index$="-children"]').hide(); //左固定
          leftTrChildren.siblings('[data-index$="-children"]').hide(); //右固定
        }
        success(trObjChildren, indexChildren); //回调函数
        heightChildren = trObjChildren.height(); //展开高度固定
        rightTrChildren.height(heightChildren + 115).toggle(); //左固定
        leftTrChildren.height(heightChildren + 115).toggle(); //右固定
      }
    });

  </script>
</body>

</html>
